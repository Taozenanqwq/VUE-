{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/reactive.ts", "../src/computed.ts", "../src/watch.ts", "../src/ref.ts"],
  "sourcesContent": ["export { effect } from './effect'\r\nexport { reactive } from './reactive'\r\nexport { computed } from './computed'\r\nexport { watch } from './watch'\r\nexport { ref } from './ref'\r\n", "export let activeEffect\r\nexport class ReactiveEffect {\r\n  public active = true\r\n  public parent = null\r\n  public deps = []\r\n  constructor(public fn, public schedular) {}\r\n  run() {\r\n    if (!this.active) return this.fn()\r\n    try {\r\n      this.parent = activeEffect\r\n      activeEffect = this\r\n      /** \u6267\u884C\u524D\u6E05\u7A7A\u76F8\u5173\u4F9D\u8D56\uFF0C\u6BCF\u6B21\u90FD\u91CD\u65B0\u6536\u96C6\uFF0C\u8003\u8651\u5206\u652F\u5207\u6362\u573A\u666F */\r\n      cleanupEffects(this)\r\n      return this.fn()\r\n    } finally {\r\n      activeEffect = this.parent\r\n      this.parent = null\r\n    }\r\n  }\r\n  stop() {\r\n    //\u505C\u6B62\u6536\u96C6\u4F9D\u8D56\u5E76\u4E14\u6E05\u7A7A\u4F9D\u8D56\r\n    if (this.active) this.active = false\r\n    cleanupEffects(this)\r\n  }\r\n}\r\n\r\nexport function effect(fn, options: any = {}) {\r\n  const _effect = new ReactiveEffect(fn, options.schedular)\r\n  _effect.run()\r\n  const runner = _effect.run.bind(_effect) /** \u7ED1\u5B9Athis\u503C */\r\n  runner.effect = _effect\r\n  return runner /** \u8FD4\u56DE\u8BE5runner\u53EF\u4EE5\u5B9E\u73B0\u5BF9effect\u7684\u63A7\u5236 */\r\n}\r\n\r\nconst targetMap = new WeakMap()\r\nexport function trackEffect(target, key) {\r\n  if (!activeEffect) return\r\n  let depsMap = targetMap.get(target)\r\n  if (!depsMap) {\r\n    targetMap.set(target, (depsMap = new Map()))\r\n  }\r\n  let dep = depsMap.get(key)\r\n  if (!dep) {\r\n    depsMap.set(key, (dep = new Set()))\r\n  }\r\n  trackDepEffect(dep)\r\n}\r\nexport function trackDepEffect(dep) {\r\n  let shouldTrack = !dep.has(activeEffect)\r\n  if (shouldTrack) {\r\n    dep.add(activeEffect)\r\n    activeEffect.deps.push(dep)\r\n  }\r\n}\r\n\r\nexport function triggerEffect(target, key, value) {\r\n  const depsMap = targetMap.get(target)\r\n  if (!depsMap) return\r\n  let dep = depsMap.get(key)\r\n  if (!dep) return\r\n  /** \u4E0D\u65AD\u6E05\u7A7A\u4F9D\u8D56\uFF0C\u5220\u9664\u4F9D\u8D56\u5F62\u6210\u6B7B\u5FAA\u73AF\uFF0C\u56E0\u6B64\u9700\u8981\u6BCF\u6B21\u590D\u5236\u4E00\u4EFD\u4F9D\u8D56\u6267\u884C */\r\n  triggerDepEffect(dep)\r\n}\r\nexport function triggerDepEffect(dep) {\r\n  dep = new Set(dep)\r\n  dep &&\r\n    dep.forEach((effect) => {\r\n      if (effect !== activeEffect)\r\n        effect.schedular ? effect.schedular() : effect.run()\r\n    })\r\n}\r\n\r\nfunction cleanupEffects(activeEffect) {\r\n  const { deps } = activeEffect\r\n  for (let key of deps) {\r\n    key.delete(activeEffect)\r\n  }\r\n  activeEffect.deps = []\r\n}\r\n", "export const isObject = (obj) => typeof obj === 'object' && obj !== null\r\nexport const isFunction = (obj) => typeof obj === 'function'\r\n", "import { isObject } from '@vue/shared'\r\nimport { trackEffect, triggerEffect } from './effect'\r\n/** \u8BB0\u5F55\u539F\u5BF9\u8C61\u548C\u4EE3\u7406\u5BF9\u8C61\u7684\u5173\u7CFB */\r\nconst reactiveMap = new WeakMap()\r\n\r\n/** \u4E00\u4E9B\u6807\u8BC6\u5B57\u6BB5 */\r\nconst enum ReactiveFlags {\r\n  IS_REACTIVE = '__v_isReactive',\r\n}\r\n\r\nexport function isReactive(obj) {\r\n  if (isObject(obj) && obj[ReactiveFlags.IS_REACTIVE]) return true\r\n  return false\r\n}\r\n\r\nexport function reactive(obj) {\r\n  if (!isObject(obj)) return obj\r\n  if (obj[ReactiveFlags.IS_REACTIVE]) return obj\r\n  if (reactiveMap.has(obj))\r\n    return reactiveMap.get(obj) /** \u5DF2\u7ECF\u5B58\u5728map\u91CC\u76F4\u63A5\u8D70\u7F13\u5B58 */\r\n  const proxy = new Proxy(obj, {\r\n    get(target, key, receiver) {\r\n      /** \u5224\u65AD\u662F\u5426\u5DF2\u7ECF\u4E3A\u4EE3\u7406\u5BF9\u8C61 */\r\n      if (key === ReactiveFlags.IS_REACTIVE) return true\r\n      trackEffect(target, key)\r\n      let res = Reflect.get(target, key, receiver)\r\n      /** \u5982\u679C\u8BE5\u503C\u8FD8\u662F\u5BF9\u8C61\u5219\u8FD4\u56DE\u5B83\u7684\u4EE3\u7406 */\r\n      if (isObject(res)) {\r\n        return reactive(res)\r\n      }\r\n      return res\r\n    },\r\n    set(target, key, value, receiver) {\r\n      let oldValue = target[key]\r\n      let result = Reflect.set(target, key, value, receiver)\r\n      if (oldValue !== value) {\r\n        triggerEffect(target, key, value)\r\n      }\r\n      return result\r\n    },\r\n  })\r\n  return proxy\r\n}\r\nexport function toReactive(val) {\r\n  if (isObject(val)) {\r\n    return reactive(val)\r\n  } else {\r\n    return val\r\n  }\r\n}\r\n", "import { isFunction, isObject } from '@vue/shared'\r\nimport { effect, ReactiveEffect } from './effect'\r\nimport { trackDepEffect, triggerDepEffect } from './effect'\r\nimport { activeEffect } from './effect'\r\nclass ComputedRefImpl {\r\n  public _dirty = true\r\n  public _value\r\n  public effect\r\n  public __v_isReadonly = true\r\n  public __v_isRef = true\r\n  public dep = new Set()\r\n  constructor(getter, public setter) {\r\n    this.effect = new ReactiveEffect(getter, () => {\r\n      if (!this._dirty) {\r\n        this._dirty = true\r\n        triggerDepEffect(this.dep)\r\n      }\r\n    })\r\n  }\r\n  get value() {\r\n    if (activeEffect) trackDepEffect(this.dep)\r\n    if (this._dirty) {\r\n      this._dirty = false\r\n      this._value = this.effect.run()\r\n    }\r\n    return this._value\r\n  }\r\n  set value(newValue) {\r\n    this.setter(newValue)\r\n  }\r\n}\r\nexport const computed = (config) => {\r\n  let onlyGetter = isFunction(config)\r\n  let getter\r\n  let setter\r\n  if (onlyGetter) {\r\n    getter = config\r\n    setter = () => console.warn('no setter')\r\n  } else {\r\n    getter = config.getter\r\n    setter = config.setter\r\n  }\r\n  return new ComputedRefImpl(getter, setter)\r\n}\r\n", "import { ReactiveEffect } from './effect'\r\nimport { isFunction, isObject } from '@vue/shared'\r\nimport { isReactive } from './reactive'\r\n\r\nfunction traversal(source, set) {\r\n  if (!isObject(source)) return\r\n  for (let key of source) {\r\n    if (!set.has(key)) {\r\n      traversal(key, set)\r\n      set.add(key)\r\n    }\r\n  }\r\n}\r\nexport function watch(source, cb) {\r\n  let callback\r\n  let clean\r\n  if (isReactive(source)) {\r\n    let set = new Set()\r\n    source = () => traversal(source, set)\r\n  } else if (!isFunction(source)) {\r\n    return\r\n  }\r\n  let onCleanup = (fn) => {\r\n    clean = fn\r\n  }\r\n  let oldValue\r\n  callback = () => {\r\n    clean && clean()\r\n    let newValue = effect.run()\r\n    cb(newValue, oldValue, onCleanup)\r\n    oldValue = newValue\r\n  }\r\n  const effect = new ReactiveEffect(source, callback)\r\n  oldValue = effect.run()\r\n}\r\n", "import { toReactive } from './reactive'\r\nimport { activeEffect, trackDepEffect, triggerDepEffect } from './effect'\r\nclass RefImpl {\r\n  public dep = new Set()\r\n  public _v_isRef\r\n  public _value\r\n  constructor(public _rawVal) {\r\n    this._value = toReactive(_rawVal)\r\n  }\r\n  get value() {\r\n    if (activeEffect) {\r\n      trackDepEffect(this.dep)\r\n    }\r\n    return this._value\r\n  }\r\n  set value(newVal) {\r\n    if (newVal !== this._rawVal) {\r\n      this._rawVal = newVal\r\n      this._value = toReactive(newVal)\r\n      triggerDepEffect(this.dep)\r\n    }\r\n  }\r\n}\r\n\r\nfunction createRef(value) {\r\n  return new RefImpl(value)\r\n}\r\nexport function ref(val) {\r\n  return createRef(val)\r\n}\r\n"],
  "mappings": "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",
  "names": ["effect", "activeEffect", "effect"]
}
