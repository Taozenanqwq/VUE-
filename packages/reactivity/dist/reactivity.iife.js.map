{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/index.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { effect } from './effect'\r\nexport { reactive } from './reactive'", "let activeEffect\r\nexport class ReactiveEffect{\r\n  public active = true\r\n  public parent = null\r\n  public deps = []\r\n  constructor(public fn){\r\n    this.run()\r\n  }\r\n  run(){\r\n    if(!this.active) return this.fn()\r\n    try{\r\n      this.parent = activeEffect\r\n      activeEffect = this\r\n      return this.fn()\r\n    }finally{  \r\n      activeEffect = this.parent\r\n      this.parent = null\r\n    }\r\n  }\r\n}\r\n\r\nexport function effect(fn){\r\n  const _effect = new ReactiveEffect(fn)\r\n}\r\n\r\nconst targetMap = new WeakMap()\r\nexport function trackEffect(target, key){\r\n  if(!activeEffect) return \r\n  let depsMap = targetMap.get(target)\r\n  if(!depsMap){\r\n    targetMap.set(target,depsMap = new Map())\r\n  }\r\n  let dep = depsMap.get(key)\r\n  if(!dep){\r\n    depsMap.set(key,dep = new Set())\r\n  }\r\n  let shouldTrack = !dep.has(activeEffect)\r\n  if(shouldTrack) {\r\n    dep.add(activeEffect)\r\n    activeEffect.deps.push(dep)\r\n  }\r\n}\r\n\r\nexport function triggerEffect(target, key, value){\r\n  const depsMap = targetMap.get(target)\r\n  if(!depsMap) return\r\n  const dep = depsMap.get(key)\r\n  if(!dep) return \r\n  dep && dep.forEach((effect)=>{\r\n    if(effect !== activeEffect) effect.run()\r\n  })\r\n}", "export const isObject = (obj)=> typeof obj === 'object' && obj !== null", "import { isObject } from \"@vue/shared\";\r\nimport { trackEffect, triggerEffect } from \"./effect\";\r\n/** \u8BB0\u5F55\u539F\u5BF9\u8C61\u548C\u4EE3\u7406\u5BF9\u8C61\u7684\u5173\u7CFB */\r\nconst reactiveMap = new WeakMap()\r\n\r\n/** \u4E00\u4E9B\u6807\u8BC6\u5B57\u6BB5 */\r\nconst enum ReactiveFlags{\r\n  IS_REACTIVE = '__v_isReactive'\r\n}\r\n\r\n\r\n\r\nexport function reactive(obj){\r\n  if(!isObject(obj)) return obj\r\n  if(obj[ReactiveFlags.IS_REACTIVE]) return obj \r\n  if(reactiveMap.has(obj)) return reactiveMap.get(obj) /** \u5DF2\u7ECF\u5B58\u5728map\u91CC\u76F4\u63A5\u8D70\u7F13\u5B58 */\r\n  const proxy = new Proxy(obj, {\r\n    get(target, key, receiver){\r\n      /** \u5224\u65AD\u662F\u5426\u5DF2\u7ECF\u4E3A\u4EE3\u7406\u5BF9\u8C61 */\r\n      if(key === ReactiveFlags.IS_REACTIVE) return true\r\n      trackEffect(target,key)\r\n      return Reflect.get(target, key, receiver)\r\n    },\r\n    set(target, key, value, receiver){\r\n      let oldValue = target[key]\r\n      let result = Reflect.set(target, key, value, receiver)\r\n      if(oldValue !== value) {\r\n        triggerEffect(target, key, value)\r\n      }\r\n      return result\r\n    }\r\n  })\r\n  return proxy\r\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA,MAAI;AACG,MAAM,iBAAN,MAAoB;AAAA,IAIzB,YAAmB,IAAG;AAAH;AAHnB,WAAO,SAAS;AAChB,WAAO,SAAS;AAChB,WAAO,OAAO,CAAC;AAEb,WAAK,IAAI;AAAA,IACX;AAAA,IACA,MAAK;AACH,UAAG,CAAC,KAAK;AAAQ,eAAO,KAAK,GAAG;AAChC,UAAG;AACD,aAAK,SAAS;AACd,uBAAe;AACf,eAAO,KAAK,GAAG;AAAA,MACjB,UAAC;AACC,uBAAe,KAAK;AACpB,aAAK,SAAS;AAAA,MAChB;AAAA,IACF;AAAA,EACF;AAEO,WAAS,OAAO,IAAG;AACxB,UAAM,UAAU,IAAI,eAAe,EAAE;AAAA,EACvC;AAEA,MAAM,YAAY,oBAAI,QAAQ;AACvB,WAAS,YAAY,QAAQ,KAAI;AACtC,QAAG,CAAC;AAAc;AAClB,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAG,CAAC,SAAQ;AACV,gBAAU,IAAI,QAAO,UAAU,oBAAI,IAAI,CAAC;AAAA,IAC1C;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAG,CAAC,KAAI;AACN,cAAQ,IAAI,KAAI,MAAM,oBAAI,IAAI,CAAC;AAAA,IACjC;AACA,QAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,QAAG,aAAa;AACd,UAAI,IAAI,YAAY;AACpB,mBAAa,KAAK,KAAK,GAAG;AAAA,IAC5B;AAAA,EACF;AAEO,WAAS,cAAc,QAAQ,KAAK,OAAM;AAC/C,UAAM,UAAU,UAAU,IAAI,MAAM;AACpC,QAAG,CAAC;AAAS;AACb,UAAM,MAAM,QAAQ,IAAI,GAAG;AAC3B,QAAG,CAAC;AAAK;AACT,WAAO,IAAI,QAAQ,CAACA,YAAS;AAC3B,UAAGA,YAAW;AAAc,QAAAA,QAAO,IAAI;AAAA,IACzC,CAAC;AAAA,EACH;;;ACnDO,MAAM,WAAW,CAAC,QAAO,OAAO,QAAQ,YAAY,QAAQ;;;ACGnE,MAAM,cAAc,oBAAI,QAAQ;AASzB,WAAS,SAAS,KAAI;AAC3B,QAAG,CAAC,SAAS,GAAG;AAAG,aAAO;AAC1B,QAAG,IAAI;AAA4B,aAAO;AAC1C,QAAG,YAAY,IAAI,GAAG;AAAG,aAAO,YAAY,IAAI,GAAG;AACnD,UAAM,QAAQ,IAAI,MAAM,KAAK;AAAA,MAC3B,IAAI,QAAQ,KAAK,UAAS;AAExB,YAAG,QAAQ;AAA2B,iBAAO;AAC7C,oBAAY,QAAO,GAAG;AACtB,eAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,MAC1C;AAAA,MACA,IAAI,QAAQ,KAAK,OAAO,UAAS;AAC/B,YAAI,WAAW,OAAO;AACtB,YAAI,SAAS,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AACrD,YAAG,aAAa,OAAO;AACrB,wBAAc,QAAQ,KAAK,KAAK;AAAA,QAClC;AACA,eAAO;AAAA,MACT;AAAA,IACF,CAAC;AACD,WAAO;AAAA,EACT;",
  "names": ["effect"]
}
